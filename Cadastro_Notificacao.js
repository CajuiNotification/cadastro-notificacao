const db=firebase.firestore(),messaging=firebase.messaging(),uid=localStorage.getItem("Uid");var nomeSession;firebase.storage().ref().child("vazio").child("if.png").getDownloadURL().then(a=>{const b=document.getElementById("imgPhotoCad");b.setAttribute("src",a)}).catch(a=>{alert(a.message)});try{function a(a){try{return!(0!=a.length)||(new URL(a),!0)}catch(a){return!1}}function b(a){try{const b=a.name.toLowerCase().split(".").pop();return!(0!=a.size)||"jpg"==b||"png"==b}catch(a){return!1}}class c{constructor(a,b,c,d,e,f){this.titulo=a,this.descricao=b,this.link=c,this.data_hora=d,this.cont=e,this.imagem=f}cadastrar(){document.querySelector("div[class='container-loader']").style.display="block",db.collection("Notifica\xE7\xF5es").add({title:this.titulo,body:this.descricao,link:this.link,data_hora:this.data_hora,enviadoPor:uid,enviadoPara:this.cont,aberto:0,url:""}).then(a=>{0<this.imagem.size?firebase.storage().ref().child("Notifica\xE7\xF5es").child(a.id).put(this.imagem).then(()=>{firebase.storage().ref().child("Notifica\xE7\xF5es").child(a.id).getDownloadURL().then(b=>{console.log(b),document.querySelector("div[class='container-loader']").style.display="none",db.collection("Notifica\xE7\xF5es").doc(a.id).update({url:b}).then(()=>{const a=new Date,b=(a.getDate()+"").padStart(2,"0"),c=(a.getMonth()+1+"").padStart(2,"0"),d=a.getFullYear()+"";var e=a.getHours()+"";0==e&&(e=a.getHours()+""+"0");var f=a.getMinutes()+"";f=10>f?(a.getMinutes()+"").padStart(2,"0"):a.getMinutes()+"";const g=`${b}/${c}/${d} as ${e}:${f}`;db.collection("historico").add({usuarioUID:uid,alteracao:`O usuario ${nomeSession} cadastrou a notificação "${this.titulo}" no dia ${g}`,data_hora:g}).then(()=>{alert("Notifica\xE7\xE3o cadastrada")}).catch(a=>{alert(a.message)})}).catch(a=>{alert(a.message)})}).catch(a=>{alert(a.message)})}).catch(a=>{alert(a.message)}):firebase.storage().ref().child("vazio").child("if.png").getDownloadURL().then(b=>{document.querySelector("div[class='container-loader']").style.display="none",db.collection("Notifica\xE7\xF5es").doc(a.id).update({url:b}).then(()=>{const a=new Date,b=(a.getDate()+"").padStart(2,"0"),c=(a.getMonth()+1+"").padStart(2,"0"),d=a.getFullYear()+"";var e=a.getHours()+"";0==e&&(e=a.getHours()+""+"0");var f=a.getMinutes()+"";f=10>f?(a.getMinutes()+"").padStart(2,"0"):a.getMinutes()+"";const g=`${b}/${c}/${d} as ${e}:${f}`;db.collection("historico").add({usuarioUID:uid,alteracao:`O usuario: ${nomeSession} cadastrou a notificação "${this.titulo}" no dia ${g}`,data_hora:g}).then(()=>{alert("Notifica\xE7\xE3o cadastrada")}).catch(a=>{alert(a.message)})}).catch(a=>{alert(a.message)})}).catch(a=>{alert(a.message)})}).catch(a=>{document.querySelector("div[class='container-loader']").style.display="none",alert(a.message)})}}var cont=1;document.querySelector("input[class='todos']").addEventListener("click",function(){if(1<cont){const c=document.querySelector("select[name=\"perfis\"]");for(var a=c.options.length,b=0;b<=a;b++)c.remove(0)}const c=document.querySelector("select[name=\"perfis\"]");c.innerHTML+=`<option>Enviar notificação a todos os usuarios</option>`,cont++}),document.querySelector("input[class='cursos']").addEventListener("click",function(){if(1<cont){const c=document.querySelector("select[name=\"perfis\"]");for(var a=c.options.length,b=0;b<=a;b++)c.remove(0)}db.collection("cursos").get().then(a=>{const b=document.querySelector("select[name=\"perfis\"]");if(0==a.docs.length){b.innerHTML+="<option>Nenhuma curso cadastrado :/</option>"}else{const c=a.docs.reduce((a,b)=>(a+=`<option>${b.data().curso}</option>`,a),"");b.innerHTML+=c}}).catch(a=>{alert(a.message)}),cont++}),document.querySelector("input[class='especifica']").addEventListener("click",function(){if(1<cont){const c=document.querySelector("select[name=\"perfis\"]");for(var a=c.options.length,b=0;b<=a;b++)c.remove(0)}db.collection("usuarios").get().then(a=>{const b=document.querySelector("select[name=\"perfis\"]");if(0==a.docs.length){b.innerHTML+="<option>Nenhuma pessoa cadastrada :/</option>"}else{const c=a.docs.reduce((a,b)=>(a+=`<option>${b.data().nome}</option>`,a),"");b.innerHTML+=c}}).catch(a=>{alert(a.message)}),cont++});const d=document.getElementById("imgPhotoCad"),e=document.querySelector("input[name=\"imagem\"]");d.addEventListener("click",function(){e.click(),e.addEventListener("change",()=>{let a=new FileReader;a.onload=()=>{d.src=a.result},a.readAsDataURL(e.files[0])})}),document.querySelector("button").addEventListener("click",function(){const d=new FormData(document.querySelector("form")),e=d.get("titulo"),f=d.get("descricao");var g=d.get("link");const h=d.get("todos");var i=d.get("imagem");if(0==e.length||0==f.length)alert("Preencha todos os campos");else{const l=new Date,m=(l.getDate()+"").padStart(2,"0"),n=(l.getMonth()+1+"").padStart(2,"0"),o=l.getFullYear()+"";var j=l.getHours()+"";0==j&&(j=l.getHours()+""+"0");var k=l.getMinutes()+"";k=10>k?(l.getMinutes()+"").padStart(2,"0"):l.getMinutes()+"";const p=`${m}/${n}/${o} as ${j}:${k}`;if(!a(g))alert("Link invalido");else if(!b(i))alert("Extens\xE3o de imagem n\xE3o aceita");else if(null==h)alert("Selecione o tipo de envio");else if("todos"===h)db.collection("usuarios").get().then(a=>{var b=null;a.forEach(a=>{const c=a.data().token;let d={method:"POST",headers:new Headers({Authorization:"key=AAAASSRJZdU:APA91bFgE5CfkW8F0fgooOA7h_z5n2NIr1L3VcZ7Ahe3AwT20NqPuWNECuQkjDrnp4fHogLIsuRIizYM6XnLAONn6qtUdJBbBKLJRIrdJQlYkug8lCTEAj2R0sWEfaFrU1GDw8yfdUnf","Content-Type":"application/json"}),body:JSON.stringify({to:c,notification:{title:e,body:f,icon:"IF.jpg",click_action:g}})};fetch("https://fcm.googleapis.com/fcm/send",d).then(a=>{console.log("Send "+a)}).catch(a=>{alert(a.message)}),b++});var d=new c(e,f,g,p,b,i);d.cadastrar()}).catch(a=>{alert(a.message)});else if("cursos"===h){const a=d.get("perfis");db.collection("usuarios").where("curso","==",a).get().then(a=>{var b=null;a.forEach(a=>{const c=a.data().token;let d={method:"POST",headers:new Headers({Authorization:"key=AAAASSRJZdU:APA91bFgE5CfkW8F0fgooOA7h_z5n2NIr1L3VcZ7Ahe3AwT20NqPuWNECuQkjDrnp4fHogLIsuRIizYM6XnLAONn6qtUdJBbBKLJRIrdJQlYkug8lCTEAj2R0sWEfaFrU1GDw8yfdUnf","Content-Type":"application/json"}),body:JSON.stringify({to:c,notification:{title:e,body:f,icon:"IF.jpg",click_action:g}})};fetch("https://fcm.googleapis.com/fcm/send",d).then(a=>{console.log("Send "+a)}).catch(a=>{alert(a.message)}),b++});var d=new c(e,f,g,p,b,i);d.cadastrar()}).catch(a=>{alert(a.message)})}else{const a=d.get("perfis");db.collection("usuarios").where("nome","==",a).get().then(a=>{var b=null;a.forEach(a=>{const c=a.data().token;let d={method:"POST",headers:new Headers({Authorization:"key=AAAASSRJZdU:APA91bFgE5CfkW8F0fgooOA7h_z5n2NIr1L3VcZ7Ahe3AwT20NqPuWNECuQkjDrnp4fHogLIsuRIizYM6XnLAONn6qtUdJBbBKLJRIrdJQlYkug8lCTEAj2R0sWEfaFrU1GDw8yfdUnf","Content-Type":"application/json"}),body:JSON.stringify({to:c,notification:{title:e,body:f,icon:"IF.jpg",click_action:g}})};fetch("https://fcm.googleapis.com/fcm/send",d).then(a=>{console.log("Send "+a)}).catch(a=>{alert(a.message)}),b++});var d=new c(e,f,g,p,b,i);d.cadastrar()}).catch(a=>{alert(a.message)})}}})}catch(a){alert("Erro "+a)}